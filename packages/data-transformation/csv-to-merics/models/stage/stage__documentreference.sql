
-- SELECT statement for DocumentReference
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    meta_source,
    contained_0_resourcetype,
    contained_0_id,
    contained_0_identifier_0_value,
    contained_0_name,
    contained_1_resourcetype,
    contained_1_id,
    contained_1_name_0_family,
    contained_2_resourcetype,
    contained_2_id,
    contained_2_practitioner_reference,
    contained_2_practitioner_type,
    contained_2_organization_reference,
    contained_2_organization_type,
    contained_3_resourcetype,
    contained_3_id,
    contained_3_identifier_0_system,
    contained_3_identifier_0_value,
    contained_3_identifier_1_system,
    contained_3_identifier_1_value,
    contained_3_name_0_family,
    contained_3_name_0_given_0,
    contained_3_gender,
    contained_3_address_0_line_0,
    contained_3_address_0_city,
    contained_3_address_0_postalcode,
    contained_3_address_0_country,
    masteridentifier_system,
    masteridentifier_value,
    identifier_0_use,
    identifier_0_system,
    identifier_0_value,
    status,
    type_coding_0_system,
    type_coding_0_code,
    type_coding_0_display,
    subject_reference,
    subject_type,
    author_0_reference,
    author_0_type,
    description,
    content_0_extension_0_url,
    content_0_extension_0_valuecoding_system,
    content_0_extension_0_valuecoding_code,
    content_0_attachment_contenttype,
    content_0_attachment_url,
    content_0_attachment_size,
    content_0_attachment_title,
    content_0_attachment_creation,
    content_0_format_code,
    content_1_extension_0_url,
    content_1_extension_0_valuecoding_system,
    content_1_extension_0_valuecoding_code,
    content_1_attachment_contenttype,
    content_1_attachment_url,
    content_1_attachment_size,
    content_1_attachment_title,
    content_1_attachment_creation,
    content_1_format_code,
    context_period_start,
    context_period_end,
    context_facilitytype_coding_0_system,
    context_facilitytype_coding_0_code,
    context_facilitytype_coding_0_display,
    contained_1_name,
    docstatus,
    contained_3_address_0_state,
    contained_1_name_0_given_0,
    context_facilitytype_text,
    contained_1_identifier_0_system,
    contained_1_identifier_0_value,
    contained_1_gender,
    contained_1_address_0_line_0,
    contained_1_address_0_city,
    contained_1_address_0_state,
    contained_1_address_0_postalcode,
    contained_1_address_0_country,
    contained_1_identifier_1_system,
    contained_1_identifier_1_value,
    contained_0_name_0_family,
    contained_0_name_0_given_0,
    context_event_0_text,
    filename,
    processed_date 
FROM {{source('raw', 'documentreference') }} x

QUALIFY rank() over(partition by filename order by processed_date desc) = 1