
-- SELECT statement for Encounter
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    meta_source,
    identifier_0_type_text,
    identifier_0_system,
    identifier_0_value,
    identifier_0_assigner_display,
    status,
    class_system,
    class_code,
    class_display,
    type_0_text,
    subject_reference,
    period_start,
    period_end,
    diagnosis_0_condition_reference,
    diagnosis_1_condition_reference,
    location_0_location_reference,
    type_0_coding_0_system,
    type_0_coding_0_code,
    type_0_coding_0_display,
    type_0_coding_1_system,
    type_0_coding_1_code,
    type_0_coding_1_display,
    type_0_coding_2_system,
    type_0_coding_2_code,
    type_1_coding_0_system,
    type_1_coding_0_code,
    type_1_coding_1_system,
    type_1_coding_1_code,
    type_1_coding_2_system,
    type_1_coding_2_code,
    type_1_coding_3_system,
    type_1_coding_3_code,
    type_1_text,
    type_0_coding_2_display,
    type_0_coding_3_system,
    type_0_coding_3_code,
    type_1_coding_4_system,
    type_1_coding_4_code,
    participant_0_individual_reference,
    serviceprovider_reference,
    diagnosis_2_condition_reference,
    diagnosis_3_condition_reference,
    diagnosis_4_condition_reference,
    diagnosis_5_condition_reference,
    diagnosis_6_condition_reference,
    diagnosis_7_condition_reference,
    diagnosis_8_condition_reference,
    diagnosis_9_condition_reference,
    diagnosis_10_condition_reference,
    diagnosis_11_condition_reference,
    diagnosis_12_condition_reference,
    diagnosis_13_condition_reference,
    diagnosis_14_condition_reference,
    diagnosis_15_condition_reference,
    diagnosis_16_condition_reference,
    diagnosis_17_condition_reference,
    type_0_coding_4_system,
    type_0_coding_4_code,
    identifier_1_system,
    identifier_1_value,
    participant_1_individual_reference,
    hospitalization_dischargedisposition_coding_0_system,
    hospitalization_dischargedisposition_coding_0_code,
    hospitalization_dischargedisposition_coding_0_display,
    identifier_1_type_text,
    location_1_location_reference,
    type_1_coding_0_display,
    type_1_coding_1_display,
    type_1_coding_2_display,
    type_2_coding_0_system,
    type_2_coding_0_code,
    type_2_coding_1_system,
    type_2_coding_1_code,
    type_2_coding_2_system,
    type_2_coding_2_code,
    type_2_coding_3_system,
    type_2_coding_3_code,
    type_2_coding_4_system,
    type_2_coding_4_code,
    type_2_text,
    identifier_1_assigner_display,
    type_2_coding_0_display,
    type_2_coding_1_display,
    type_3_coding_0_system,
    type_3_coding_0_code,
    type_3_coding_1_system,
    type_3_coding_1_code,
    type_3_coding_2_system,
    type_3_coding_2_code,
    type_3_coding_3_system,
    type_3_coding_3_code,
    type_3_text,
    hospitalization_dischargedisposition_text,
    identifier_2_system,
    identifier_2_value,
    identifier_2_assigner_display,
    identifier_3_system,
    identifier_3_value,
    identifier_3_assigner_display,
    priority_text,
    priority_coding_0_code,
    priority_coding_0_display,
    priority_coding_0_system,
    type_3_coding_0_display,
    type_3_coding_1_display,
    diagnosis_18_condition_reference,
    diagnosis_19_condition_reference,
    diagnosis_20_condition_reference,
    diagnosis_21_condition_reference,
    participant_2_individual_reference,
    location_2_location_reference,
    type_4_text,
    type_4_coding_0_code,
    type_4_coding_0_display,
    type_4_coding_0_system,
    type_4_coding_1_code,
    type_4_coding_1_display,
    type_4_coding_1_system,
    type_4_coding_2_code,
    type_4_coding_2_system,
    type_5_text,
    type_5_coding_0_code,
    type_5_coding_0_system,
    type_5_coding_1_code,
    type_5_coding_1_system,
    type_5_coding_2_code,
    type_5_coding_2_system,
    type_5_coding_3_code,
    type_5_coding_3_system,
    participant_3_individual_reference,
    type_5_coding_0_display,
    type_5_coding_1_display,
    identifier_4_system,
    identifier_4_value,
    identifier_4_assigner_display,
    type_4_coding_3_code,
    type_4_coding_3_system,
    type_6_text,
    type_6_coding_0_code,
    type_6_coding_0_system,
    type_7_text,
    type_7_coding_0_code,
    type_7_coding_0_system,
    type_7_coding_1_code,
    type_7_coding_1_system,
    type_7_coding_2_code,
    type_7_coding_2_system,
    type_6_coding_0_display,
    type_6_coding_1_code,
    type_6_coding_1_system,
    identifier_5_system,
    identifier_5_value,
    identifier_5_assigner_display,
    identifier_6_system,
    identifier_6_value,
    identifier_6_assigner_display,
    identifier_7_system,
    identifier_7_value,
    identifier_7_assigner_display,
    diagnosis_22_condition_reference,
    diagnosis_23_condition_reference,
    diagnosis_24_condition_reference,
    diagnosis_25_condition_reference,
    diagnosis_26_condition_reference,
    diagnosis_27_condition_reference,
    diagnosis_28_condition_reference,
    diagnosis_29_condition_reference,
    diagnosis_30_condition_reference,
    diagnosis_31_condition_reference,
    diagnosis_32_condition_reference,
    type_2_coding_2_display,
    type_3_coding_4_code,
    type_3_coding_4_system,
    filename,
    processed_date 
FROM {{source('raw', 'encounter') }} x

QUALIFY rank() over(partition by filename order by processed_date desc) = 1