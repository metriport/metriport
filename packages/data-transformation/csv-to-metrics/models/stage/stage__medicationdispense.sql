-- SELECT statement for MedicationDispense
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    meta_source,
    identifier_0_system,
    identifier_0_type_text,
    identifier_0_value,
    identifier_1_system,
    identifier_1_type_text,
    identifier_1_value,
    identifier_2_system,
    identifier_2_type_text,
    identifier_2_value,
    subject_reference,
    subject_type,
    authorizingprescription_0_reference,
    authorizingprescription_1_reference,
    authorizingprescription_2_reference,
    category_coding_0_code,
    category_coding_0_display,
    category_coding_0_system,
    category_coding_1_code,
    category_coding_1_display,
    category_coding_1_system,
    category_text,
    context_reference,
    dayssupply_code,
    dayssupply_system,
    dayssupply_unit,
    dayssupply_value,
    destination_reference,
    detectedissue_0_reference,
    detectedissue_1_reference,
    dosageinstruction_0_additionalinstruction_0_coding_0_code,
    dosageinstruction_0_additionalinstruction_0_coding_0_display,
    dosageinstruction_0_additionalinstruction_0_coding_0_system,
    dosageinstruction_0_additionalinstruction_0_coding_1_code,
    dosageinstruction_0_additionalinstruction_0_coding_1_display,
    dosageinstruction_0_additionalinstruction_0_coding_1_system,
    dosageinstruction_0_additionalinstruction_0_text,
    dosageinstruction_0_additionalinstruction_1_coding_0_code,
    dosageinstruction_0_additionalinstruction_1_coding_0_display,
    dosageinstruction_0_additionalinstruction_1_coding_0_system,
    dosageinstruction_0_additionalinstruction_1_coding_1_code,
    dosageinstruction_0_additionalinstruction_1_coding_1_display,
    dosageinstruction_0_additionalinstruction_1_coding_1_system,
    dosageinstruction_0_additionalinstruction_1_text,
    dosageinstruction_0_additionalinstruction_2_coding_0_code,
    dosageinstruction_0_additionalinstruction_2_coding_0_display,
    dosageinstruction_0_additionalinstruction_2_coding_0_system,
    dosageinstruction_0_additionalinstruction_2_coding_1_code,
    dosageinstruction_0_additionalinstruction_2_coding_1_display,
    dosageinstruction_0_additionalinstruction_2_coding_1_system,
    dosageinstruction_0_additionalinstruction_2_text,
    dosageinstruction_0_asneededboolean,
    dosageinstruction_0_asneededcodeableconcept_coding_0_code,
    dosageinstruction_0_asneededcodeableconcept_coding_0_display,
    dosageinstruction_0_asneededcodeableconcept_coding_0_system,
    dosageinstruction_0_asneededcodeableconcept_coding_1_code,
    dosageinstruction_0_asneededcodeableconcept_coding_1_display,
    dosageinstruction_0_asneededcodeableconcept_coding_1_system,
    dosageinstruction_0_asneededcodeableconcept_text,
    dosageinstruction_0_doseandrate_0_dosequantity_code,
    dosageinstruction_0_doseandrate_0_dosequantity_system,
    dosageinstruction_0_doseandrate_0_dosequantity_unit,
    dosageinstruction_0_doseandrate_0_dosequantity_value,
    dosageinstruction_0_doseandrate_0_doserange_high_code,
    dosageinstruction_0_doseandrate_0_doserange_high_system,
    dosageinstruction_0_doseandrate_0_doserange_high_unit,
    dosageinstruction_0_doseandrate_0_doserange_high_value,
    dosageinstruction_0_doseandrate_0_doserange_low_code,
    dosageinstruction_0_doseandrate_0_doserange_low_system,
    dosageinstruction_0_doseandrate_0_doserange_low_unit,
    dosageinstruction_0_doseandrate_0_doserange_low_value,
    dosageinstruction_0_doseandrate_0_ratequantity,
    dosageinstruction_0_doseandrate_0_raterange_high,
    dosageinstruction_0_doseandrate_0_raterange_low,
    dosageinstruction_0_doseandrate_0_rateratio_denominator_code,
    dosageinstruction_0_doseandrate_0_rateratio_denominator_comparator,
    dosageinstruction_0_doseandrate_0_rateratio_denominator_system,
    dosageinstruction_0_doseandrate_0_rateratio_denominator_unit,
    dosageinstruction_0_doseandrate_0_rateratio_denominator_value,
    dosageinstruction_0_doseandrate_0_rateratio_numerator_code,
    dosageinstruction_0_doseandrate_0_rateratio_numerator_comparator,
    dosageinstruction_0_doseandrate_0_rateratio_numerator_system,
    dosageinstruction_0_doseandrate_0_rateratio_numerator_unit,
    dosageinstruction_0_doseandrate_0_rateratio_numerator_value,
    dosageinstruction_0_doseandrate_0_type_coding_0_code,
    dosageinstruction_0_doseandrate_0_type_coding_0_display,
    dosageinstruction_0_doseandrate_0_type_coding_0_system,
    dosageinstruction_0_doseandrate_0_type_coding_1_code,
    dosageinstruction_0_doseandrate_0_type_coding_1_display,
    dosageinstruction_0_doseandrate_0_type_coding_1_system,
    dosageinstruction_0_doseandrate_0_type_text,
    dosageinstruction_0_maxdoseperadministration,
    dosageinstruction_0_maxdoseperlifetime,
    dosageinstruction_0_maxdoseperperiod_denominator_code,
    dosageinstruction_0_maxdoseperperiod_denominator_comparator,
    dosageinstruction_0_maxdoseperperiod_denominator_system,
    dosageinstruction_0_maxdoseperperiod_denominator_unit,
    dosageinstruction_0_maxdoseperperiod_denominator_value,
    dosageinstruction_0_maxdoseperperiod_numerator_code,
    dosageinstruction_0_maxdoseperperiod_numerator_comparator,
    dosageinstruction_0_maxdoseperperiod_numerator_system,
    dosageinstruction_0_maxdoseperperiod_numerator_unit,
    dosageinstruction_0_maxdoseperperiod_numerator_value,
    dosageinstruction_0_method_coding_0_code,
    dosageinstruction_0_method_coding_0_display,
    dosageinstruction_0_method_coding_0_system,
    dosageinstruction_0_method_coding_1_code,
    dosageinstruction_0_method_coding_1_display,
    dosageinstruction_0_method_coding_1_system,
    dosageinstruction_0_method_text,
    dosageinstruction_0_patientinstruction,
    dosageinstruction_0_route_coding_0_code,
    dosageinstruction_0_route_coding_0_display,
    dosageinstruction_0_route_coding_0_system,
    dosageinstruction_0_route_coding_1_code,
    dosageinstruction_0_route_coding_1_display,
    dosageinstruction_0_route_coding_1_system,
    dosageinstruction_0_route_text,
    dosageinstruction_0_sequence,
    dosageinstruction_0_site_coding_0_code,
    dosageinstruction_0_site_coding_0_display,
    dosageinstruction_0_site_coding_0_system,
    dosageinstruction_0_site_coding_1_code,
    dosageinstruction_0_site_coding_1_display,
    dosageinstruction_0_site_coding_1_system,
    dosageinstruction_0_site_text,
    dosageinstruction_0_text,
    dosageinstruction_0_timing_code_coding_0_code,
    dosageinstruction_0_timing_code_coding_0_display,
    dosageinstruction_0_timing_code_coding_0_system,
    dosageinstruction_0_timing_code_coding_1_code,
    dosageinstruction_0_timing_code_coding_1_display,
    dosageinstruction_0_timing_code_coding_1_system,
    dosageinstruction_0_timing_code_text,
    dosageinstruction_0_timing_event_0,
    dosageinstruction_0_timing_event_1,
    dosageinstruction_0_timing_event_2,
    dosageinstruction_0_timing_repeat_boundsduration,
    dosageinstruction_0_timing_repeat_boundsperiod_end,
    dosageinstruction_0_timing_repeat_boundsperiod_start,
    dosageinstruction_0_timing_repeat_boundsrange_high_code,
    dosageinstruction_0_timing_repeat_boundsrange_high_system,
    dosageinstruction_0_timing_repeat_boundsrange_high_unit,
    dosageinstruction_0_timing_repeat_boundsrange_high_value,
    dosageinstruction_0_timing_repeat_boundsrange_low_code,
    dosageinstruction_0_timing_repeat_boundsrange_low_system,
    dosageinstruction_0_timing_repeat_boundsrange_low_unit,
    dosageinstruction_0_timing_repeat_boundsrange_low_value,
    dosageinstruction_0_timing_repeat_count,
    dosageinstruction_0_timing_repeat_countmax,
    dosageinstruction_0_timing_repeat_dayofweek_0,
    dosageinstruction_0_timing_repeat_dayofweek_1,
    dosageinstruction_0_timing_repeat_dayofweek_2,
    dosageinstruction_0_timing_repeat_duration,
    dosageinstruction_0_timing_repeat_durationmax,
    dosageinstruction_0_timing_repeat_durationunit,
    dosageinstruction_0_timing_repeat_frequency,
    dosageinstruction_0_timing_repeat_frequencymax,
    dosageinstruction_0_timing_repeat_offset,
    dosageinstruction_0_timing_repeat_period,
    dosageinstruction_0_timing_repeat_periodmax,
    dosageinstruction_0_timing_repeat_periodunit,
    dosageinstruction_0_timing_repeat_timeofday_0,
    dosageinstruction_0_timing_repeat_timeofday_1,
    dosageinstruction_0_timing_repeat_timeofday_2,
    dosageinstruction_0_timing_repeat_when_0,
    dosageinstruction_0_timing_repeat_when_1,
    dosageinstruction_0_timing_repeat_when_2,
    effectivedatetime,
    effectiveperiod_end,
    effectiveperiod_start,
    medicationcodeableconcept_coding_0_code,
    medicationcodeableconcept_coding_0_display,
    medicationcodeableconcept_coding_0_system,
    medicationcodeableconcept_coding_1_code,
    medicationcodeableconcept_coding_1_display,
    medicationcodeableconcept_coding_1_system,
    medicationcodeableconcept_text,
    medicationreference_reference,
    note_0_author_reference,
    note_0_text,
    note_0_time,
    note_1_author_reference,
    note_1_text,
    note_1_time,
    note_2_author_reference,
    note_2_text,
    note_2_time,
    note_3_author_reference,
    note_3_text,
    note_3_time,
    note_4_author_reference,
    note_4_text,
    note_4_time,
    performer_0_actor_reference,
    performer_0_function_coding_0_code,
    performer_0_function_coding_0_display,
    performer_0_function_coding_0_system,
    performer_0_function_coding_1_code,
    performer_0_function_coding_1_display,
    performer_0_function_coding_1_system,
    performer_0_function_text,
    performer_1_actor_reference,
    performer_1_function_coding_0_code,
    performer_1_function_coding_0_display,
    performer_1_function_coding_0_system,
    performer_1_function_coding_1_code,
    performer_1_function_coding_1_display,
    performer_1_function_coding_1_system,
    performer_1_function_text,
    quantity_code,
    quantity_system,
    quantity_unit,
    quantity_value,
    receiver_0_reference,
    receiver_1_reference,
    receiver_2_reference,
    receiver_3_reference,
    receiver_4_reference,
    receiver_5_reference,
    receiver_6_reference,
    receiver_7_reference,
    receiver_8_reference,
    receiver_9_reference,
    status,
    statusreason_coding_0_code,
    statusreason_coding_0_display,
    statusreason_coding_0_system,
    statusreason_coding_1_code,
    statusreason_coding_1_display,
    statusreason_coding_1_system,
    statusreason_text,
    type_coding_0_code,
    type_coding_0_display,
    type_coding_0_system,
    type_coding_1_code,
    type_coding_1_display,
    type_coding_1_system,
    type_text,
    whenhandedover,
    whenprepared,
    filename,
    processed_date 
FROM {{source('raw', 'medicationdispense') }} x

QUALIFY rank() over(partition by filename order by processed_date desc) = 1