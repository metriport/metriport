-- SELECT statement for MedicationAdministration
SELECT 
    resourcetype,
    id,
    meta_versionid,
    meta_lastupdated,
    meta_source,
    identifier_0_system,
    identifier_0_type_text,
    identifier_0_value,
    identifier_1_system,
    identifier_1_type_text,
    identifier_1_value,
    identifier_2_system,
    identifier_2_type_text,
    identifier_2_value,
    identifier_3_system,
    identifier_3_type_text,
    identifier_3_value,
    subject_reference,
    subject_type,
    category_coding_0_code,
    category_coding_0_display,
    category_coding_0_system,
    category_coding_1_code,
    category_coding_1_display,
    category_coding_1_system,
    category_text,
    context_reference,
    context_type,
    device_0_reference,
    device_1_reference,
    dosage_dose_code,
    dosage_dose_system,
    dosage_dose_unit,
    dosage_dose_value,
    dosage_method_coding_0_code,
    dosage_method_coding_0_display,
    dosage_method_coding_0_system,
    dosage_method_coding_1_code,
    dosage_method_coding_1_display,
    dosage_method_coding_1_system,
    dosage_method_text,
    dosage_ratequantity_code,
    dosage_ratequantity_system,
    dosage_ratequantity_unit,
    dosage_ratequantity_value,
    dosage_rateratio_denominator_code,
    dosage_rateratio_denominator_comparator,
    dosage_rateratio_denominator_system,
    dosage_rateratio_denominator_unit,
    dosage_rateratio_denominator_value,
    dosage_rateratio_numerator_code,
    dosage_rateratio_numerator_comparator,
    dosage_rateratio_numerator_system,
    dosage_rateratio_numerator_unit,
    dosage_rateratio_numerator_value,
    dosage_route_coding_0_code,
    dosage_route_coding_0_display,
    dosage_route_coding_0_system,
    dosage_route_coding_1_code,
    dosage_route_coding_1_display,
    dosage_route_coding_1_system,
    dosage_route_text,
    dosage_site_coding_0_code,
    dosage_site_coding_0_display,
    dosage_site_coding_0_system,
    dosage_site_coding_1_code,
    dosage_site_coding_1_display,
    dosage_site_coding_1_system,
    dosage_site_text,
    dosage_text,
    effectivedatetime,
    effectiveperiod_end,
    effectiveperiod_start,
    eventhistory_0_reference,
    eventhistory_1_reference,
    instantiates_0,
    instantiates_1,
    medicationcodeableconcept_coding_0_code,
    medicationcodeableconcept_coding_0_display,
    medicationcodeableconcept_coding_0_system,
    medicationcodeableconcept_coding_1_code,
    medicationcodeableconcept_coding_1_display,
    medicationcodeableconcept_coding_1_system,
    medicationcodeableconcept_text,
    medicationreference_reference,
    note_0_author_reference,
    note_0_text,
    note_0_time,
    note_1_author_reference,
    note_1_text,
    note_1_time,
    note_2_author_reference,
    note_2_text,
    note_2_time,
    note_3_author_reference,
    note_3_text,
    note_3_time,
    note_4_author_reference,
    note_4_text,
    note_4_time,
    partof_0_reference,
    partof_1_reference,
    performer_0_actor_reference,
    performer_0_function_coding_0_code,
    performer_0_function_coding_0_display,
    performer_0_function_coding_0_system,
    performer_0_function_coding_1_code,
    performer_0_function_coding_1_display,
    performer_0_function_coding_1_system,
    performer_0_function_text,
    performer_1_actor_reference,
    performer_1_function_coding_0_code,
    performer_1_function_coding_0_display,
    performer_1_function_coding_0_system,
    performer_1_function_coding_1_code,
    performer_1_function_coding_1_display,
    performer_1_function_coding_1_system,
    performer_1_function_text,
    reasoncode_0_coding_0_code,
    reasoncode_0_coding_0_display,
    reasoncode_0_coding_0_system,
    reasoncode_0_coding_1_code,
    reasoncode_0_coding_1_display,
    reasoncode_0_coding_1_system,
    reasoncode_0_text,
    reasoncode_1_coding_0_code,
    reasoncode_1_coding_0_display,
    reasoncode_1_coding_0_system,
    reasoncode_1_coding_1_code,
    reasoncode_1_coding_1_display,
    reasoncode_1_coding_1_system,
    reasoncode_1_text,
    reasonreference_0_reference,
    reasonreference_1_reference,
    reasonreference_2_reference,
    reasonreference_3_reference,
    reasonreference_4_reference,
    reasonreference_5_reference,
    reasonreference_6_reference,
    reasonreference_7_reference,
    reasonreference_8_reference,
    reasonreference_9_reference,
    request_reference,
    status,
    statusreason_coding_0_code,
    statusreason_coding_0_display,
    statusreason_coding_0_system,
    statusreason_coding_1_code,
    statusreason_coding_1_display,
    statusreason_coding_1_system,
    statusreason_text,
    filename,
    processed_date 
FROM {{source('raw', 'medicationadministration') }} x

QUALIFY rank() over(partition by filename order by processed_date desc) = 1