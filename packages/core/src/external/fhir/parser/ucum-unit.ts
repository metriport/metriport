import { UNIT_OF_MEASURE_URL } from "@metriport/shared/medical";
import { Quantity } from "@medplum/fhirtypes";
import { getFirstToken } from "./shared";

export function createUcumQuantity(value: number, code: string): Quantity {
  return {
    value,
    unit: code,
    system: UNIT_OF_MEASURE_URL,
    code,
  };
}

export function parseUcumUnit(
  inputString: string
): { code?: string; remainder: string } | undefined {
  const [unit, remainder] = getFirstToken(inputString);
  const validCode = getValidUcumCode(unit);
  if (!validCode) return undefined;
  return { code: validCode, remainder };
}

export function getValidUcumCode(inputString: string): string | undefined {
  const unit = inputString.trim();
  const validCode = unitToValidUcumCode[unit];
  return validCode;
}

export const unitToValidUcumCode: Record<string, string> = {
  U: "U",
  u: "U",
  unit: "U",
  units: "U",
  "%": "%",
  "/uL": "/uL",
  "[iU]/L": "[iU]/L",
  "IU/L": "[iU]/L",
  "10*3/uL": "10*3/uL",
  "K/uL": "10*3/uL",
  "x10^3/mm^3": "10*3/uL",
  "10*6/uL": "10*6/uL",
  "M/uL": "10*6/uL",
  "x10^6/mm^3": "10*6/uL",
  fL: "fL",
  "g/dL": "g/dL",
  "g/L": "g/L",
  "g/mL": "g/mL",
  kPa: "kPa",
  "m[iU]/mL": "m[iU]/mL",
  "mIU/mL": "m[iU]/mL",
  "meq/L": "meq/L",
  "mEq/L": "meq/L",
  "mg/dL": "mg/dL",
  "mm[Hg]": "mm[Hg]",
  "mm Hg": "mm[Hg]",
  "mmol/kg": "mmol/kg",
  "mmol/L": "mmol/L",
  "mosm/kg": "mosm/kg",
  "mOsm/kg": "mosm/kg",
  "ng/mL": "ng/mL",
  "nmol/L": "nmol/L",
  pg: "pg",
  "pg/mL": "pg/mL",
  "pmol/L": "pmol/L",
  "U/L": "U/L",
  "u[iU]/mL": "u[iU]/mL",
  "uIU/mL": "u[iU]/mL",
  "ug/dL": "ug/dL",
  "ug/L": "ug/L",
  "ug/mL": "ug/mL",
  "umol/L": "umol/L",
  "[lg]": "[lg]",
  "log 10": "[lg]",
  "10*6/{Specimen}": "10*6/{Specimen}",
  "x10^6/spec": "10*6/{Specimen}",
  "/{tot}": "/{tot}",
  "/Total": "/{tot}",
  "10*3": "10*3",
  "x10^3": "10*3",
  "10*3.{RBC}": "10*3.{RBC}",
  "x10^3 RBCs": "10*3.{RBC}",
  "10*5": "10*5",
  "x10^5": "10*5",
  "10*6": "10*6",
  "x10^6": "10*6",
  "10*8": "10*8",
  "x10^8": "10*8",
  "{Relative}%": "{Relative}%",
  "Relative %": "{Relative}%",
  "%{Total}": "%{Total}",
  "% of Total": "%{Total}",
  "%{0to3Hours}": "%{0to3Hours}",
  "% 0-3 h": "%{0to3Hours}",
  "/10*10": "/10*10",
  "/10^10": "/10*10",
  "/10*6": "/10*6",
  "/10^6": "/10*6",
  "/10*9": "/10*9",
  "/10^9": "/10*9",
  "/10*12": "/10*12",
  "/10^12": "/10*12",
  "%{Normal}": "%{Normal}",
  "% Normal": "%{Normal}",
  "%{SpermMotility}": "%{SpermMotility}",
  "% Sperm Motility": "%{SpermMotility}",
  "%{Positive}": "%{Positive}",
  "% Positive": "%{Positive}",
  "%{FetalErythrocytes}": "%{FetalErythrocytes}",
  "% Fetal RBC": "%{FetalErythrocytes}",
  "%{OfLymphocytes}": "%{OfLymphocytes}",
  "% Lymphs": "%{OfLymphocytes}",
  "%{ofBacteria}": "%{ofBacteria}",
  "% Bacteria": "%{ofBacteria}",
  "%{OfWBCs}": "%{OfWBCs}",
  "% WBCs": "%{OfWBCs}",
  "%{Abnormal}": "%{Abnormal}",
  "% Abnormal": "%{Abnormal}",
  "%{EosSeen}": "%{EosSeen}",
  "% EOS Seen": "%{EosSeen}",
  "%{Hemolysis}": "%{Hemolysis}",
  "% Hemolysis": "%{Hemolysis}",
  "%{Blockade}": "%{Blockade}",
  "% Blockade": "%{Blockade}",
  "%/100{WBC}": "%/100{WBC}",
  "% per 100 WBC": "%/100{WBC}",
  "%{Binding}": "%{Binding}",
  "% Binding": "%{Binding}",
  "%{TotalProtein}": "%{TotalProtein}",
  "% Total Protein": "%{TotalProtein}",
  "%{Bound}": "%{Bound}",
  "% Bound": "%{Bound}",
  "%{Hemoglobin}": "%{Hemoglobin}",
  "% Hgb": "%{Hemoglobin}",
  "%{HemoglobinSaturation}": "%{HemoglobinSaturation}",
  "% Hgb SAT": "%{HemoglobinSaturation}",
  "%{Carboxyhemoglobin}": "%{Carboxyhemoglobin}",
  "% CO Hgb": "%{Carboxyhemoglobin}",
  "%{HemoglobinA1C}": "%{HemoglobinA1C}",
  "% Hgb A1C": "%{HemoglobinA1C}",
  "%{Excretion}": "%{Excretion}",
  "% Excretion": "%{Excretion}",
  "%{Uptake}": "%{Uptake}",
  "% Uptake": "%{Uptake}",
  "ug/ng": "ug/ng",
  "ng/mg": "ng/mg",
  "ng/mg{Protein}": "ng/mg{Protein}",
  "ng/mg Prot": "ng/mg{Protein}",
  "ug/mg": "ug/mg",
  "ug/mg{Cre}": "ug/mg{Cre}",
  "ug/mg Cre": "ug/mg{Cre}",
  "mg/mg": "mg/mg",
  "mg/mg{Cre}": "mg/mg{Cre}",
  "mg/mg Cre": "mg/mg{Cre}",
  "ng/g": "ng/g",
  "ng/g{Cre}": "ng/g{Cre}",
  "ng/g Cre": "ng/g{Cre}",
  "ug/g": "ug/g",
  "ug/[100]g": "ug/[100]g",
  "ug/100 g": "ug/[100]g",
  "ug/g{DryWeight}": "ug/g{DryWeight}",
  "ug/g Dry Weight": "ug/g{DryWeight}",
  "ug/g{Cre}": "ug/g{Cre}",
  "ug/g Cre": "ug/g{Cre}",
  "ug/g{Hgb}": "ug/g{Hgb}",
  "ug/g Hgb": "ug/g{Hgb}",
  "mg/g": "mg/g",
  "mg/g{Cre}": "mg/g{Cre}",
  "mg/g Cre": "mg/g{Cre}",
  "g/g": "g/g",
  "ng/kg": "ng/kg",
  "ug/kg": "ug/kg",
  "mg/kg": "mg/kg",
  "g/kg": "g/kg",
  "g/[100]g": "g/[100]g",
  "g/100g": "g/[100]g",
  "g/g{Cre}": "g/g{Cre}",
  "g/g Cre": "g/g{Cre}",
  "pmol/umol": "pmol/umol",
  "nmol/mmol": "nmol/mmol",
  "nmol/mmol{Cre}": "nmol/mmol{Cre}",
  "nmol/mmol Cre": "nmol/mmol{Cre}",
  "nmol/mol": "nmol/mol",
  "umol/mol": "umol/mol",
  "mmol/mol": "mmol/mol",
  "mmol/mol{Cre}": "mmol/mol{Cre}",
  "mmol/mol Cre": "mmol/mol{Cre}",
  "umol/mol{Cre}": "umol/mol{Cre}",
  "umol/mol Cre": "umol/mol{Cre}",
  "eq/umol": "eq/umol",
  "eq/mmol": "eq/mmol",
  "{BoneCollagen}eq/mmol{Cre}": "{BoneCollagen}eq/mmol{Cre}",
  "BCE/mmol Cre": "{BoneCollagen}eq/mmol{Cre}",
  "{BoneCollagen}eq/umol{Cre}": "{BoneCollagen}eq/umol{Cre}",
  "BCE/umol Cre": "{BoneCollagen}eq/umol{Cre}",
  "%{vol}": "%{vol}",
  "Volume %": "%{vol}",
  "%{Oxygen}": "%{Oxygen}",
  "% Oxygen": "%{Oxygen}",
  "mL/dL": "mL/dL",
  "cc/dL": "mL/dL",
  "%{NormalPooledPlasma}": "%{NormalPooledPlasma}",
  "% Normal Pooled Plasma": "%{NormalPooledPlasma}",
  "%{Activity}": "%{Activity}",
  "% Activity": "%{Activity}",
  "%{BasalActivity}": "%{BasalActivity}",
  "% Basal Activity": "%{BasalActivity}",
  "%{Inhibition}": "%{Inhibition}",
  "% Inhibition": "%{Inhibition}",
  "/{Entity}": "/{Entity}",
  "/Entity": "/{Entity}",
  "/100{WBC}": "/100{WBC}",
  "/100 WBCs": "/100{WBC}",
  "/100": "/100",
  "/100{Spermatozoa}": "/100{Spermatozoa}",
  "/100 Sperm": "/100{Spermatozoa}",
  "/10*12{rbc}": "/10*12{rbc}",
  "/10^12 RBCs": "/10*12{rbc}",
  deg: "deg",
  Deg: "deg",
  "/[arb`U]": "/[arb`U]",
  "/Arbitrary Unit": "/[arb`U]",
  "u[iU]": "u[iU]",
  uIU: "u[iU]",
  "[iU]": "[iU]",
  IU: "[iU]",
  "10*6.[iU]": "10*6.[iU]",
  "10^6  IU": "10*6.[iU]",
  "[in_i]": "[in_i]",
  in: "[in_i]",
  "[ft_i]": "[ft_i]",
  ft: "[ft_i]",
  "[yd_i]": "[yd_i]",
  yd: "[yd_i]",
  "[fth_i]": "[fth_i]",
  fathom: "[fth_i]",
  "[mi_i]": "[mi_i]",
  mi: "[mi_i]",
  "[nmi_i]": "[nmi_i]",
  "n mile": "[nmi_i]",
  "[Ch]": "[Ch]",
  "French Unit": "[Ch]",
  fm: "fm",
  pm: "pm",
  nm: "nm",
  um: "um",
  mm: "mm",
  cm: "cm",
  dm: "dm",
  m: "m",
  km: "km",
  "[gr]": "[gr]",
  gr: "[gr]",
  "[oz_av]": "[oz_av]",
  oz: "[oz_av]",
  "[oz_tr]": "[oz_tr]",
  "tr oz": "[oz_tr]",
  "[lb_av]": "[lb_av]",
  lb: "[lb_av]",
  "[ston_av]": "[ston_av]",
  Ton: "[ston_av]",
  "[dr_av]": "[dr_av]",
  dr: "[dr_av]",
  fg: "fg",
  ng: "ng",
  ug: "ug",
  "ug/{TotalVolume}": "ug/{TotalVolume}",
  "ug/Total Volume": "ug/{TotalVolume}",
  "ug/{Specimen}": "ug/{Specimen}",
  "ug/Spec": "ug/{Specimen}",
  mg: "mg",
  "mg/{Volume}": "mg/{Volume}",
  "mg/Volume": "mg/{Volume}",
  "mg/{TotalVolume}": "mg/{TotalVolume}",
  "mg/Total Volume": "mg/{TotalVolume}",
  g: "g",
  "g/{TotalWeight}": "g/{TotalWeight}",
  "g/Total Weight": "g/{TotalWeight}",
  dg: "dg",
  cg: "cg",
  kg: "kg",
  t: "t",
  "Metric Ton": "t",
  "pg/mm": "pg/mm",
  K: "K",
  Cel: "Cel",
  C: "Cel",
  "[degF]": "[degF]",
  F: "[degF]",
  "K/W": "K/W",
  "K/Watt": "K/W",
  ps: "ps",
  ns: "ns",
  us: "us",
  ms: "ms",
  s: "s",
  sec: "s",
  ks: "ks",
  Ms: "Ms",
  min: "min",
  h: "h",
  d: "d",
  wk: "wk",
  mo: "mo",
  Mo: "mo",
  a: "a",
  yr: "a",
  eq: "eq",
  ueq: "ueq",
  meq: "meq",
  "meq/{Specimen}": "meq/{Specimen}",
  "meq/Spec": "meq/{Specimen}",
  mol: "mol",
  mmol: "mmol",
  "mmol/{TotalVolume}": "mmol/{TotalVolume}",
  "mmol/Total Volume": "mmol/{TotalVolume}",
  fmol: "fmol",
  pmol: "pmol",
  umol: "umol",
  nmol: "nmol",
  mosm: "mosm",
  "meq/m2": "meq/m2",
  "meg/m^2": "meq/m2",
  "mmol/m2": "mmol/m2",
  "mmol/m^2": "mmol/m2",
  "[sin_i]": "[sin_i]",
  "in^2": "[sin_i]",
  "[sft_i]": "[sft_i]",
  "ft^2": "[sft_i]",
  "[syd_i]": "[syd_i]",
  "yd^2": "[syd_i]",
  mm2: "mm2",
  "mm^2": "mm2",
  cm2: "cm2",
  "cm^2": "cm2",
  m2: "m2",
  "m^2": "m2",
  "[foz_us]": "[foz_us]",
  "fl oz": "[foz_us]",
  "[cin_i]": "[cin_i]",
  "in^3": "[cin_i]",
  "[cup_us]": "[cup_us]",
  Cup: "[cup_us]",
  "[pt_us]": "[pt_us]",
  pt: "[pt_us]",
  "[qt_us]": "[qt_us]",
  qt: "[qt_us]",
  "[gal_us]": "[gal_us]",
  gal: "[gal_us]",
  "[fdr_us]": "[fdr_us]",
  "fl dr": "[fdr_us]",
  pL: "pL",
  nL: "nL",
  uL: "uL",
  mL: "mL",
  "mL/{h`b}": "mL/{h`b}",
  "mL/heart beat": "mL/{h`b}",
  L: "L",
  dL: "dL",
  cL: "cL",
  kL: "kL",
  hL: "hL",
  "L.s2/s": "L.s2/s",
  "L s^2/s": "L.s2/s",
  "/mg": "/mg",
  "/g": "/g",
  "/g{creat}": "/g{creat}",
  "/g Cre": "/g{creat}",
  "/g{HGB}": "/g{HGB}",
  "/g Hgb": "/g{HGB}",
  "/g{tot`nit}": "/g{tot`nit}",
  "/g Total Nitrogen": "/g{tot`nit}",
  "/g{tot`prot}": "/g{tot`prot}",
  "/g Total Protein": "/g{tot`prot}",
  "/g{wet`tis}": "/g{wet`tis}",
  "/g Wet Tissue": "/g{wet`tis}",
  "/kg": "/kg",
  "/kg{body`wt}": "/kg{body`wt}",
  "/kg Body Weight": "/kg{body`wt}",
  "fmol/mg": "fmol/mg",
  "nmol/mg": "nmol/mg",
  "umol/mg": "umol/mg",
  "umol/mg{Cre}": "umol/mg{Cre}",
  "umol/mg Cre": "umol/mg{Cre}",
  "mol/kg": "mol/kg",
  "fmol/g": "fmol/g",
  "fmol/gm": "fmol/g",
  "nmol/g": "nmol/g",
  "nmol/g{Cre}": "nmol/g{Cre}",
  "nmol/g Cre": "nmol/g{Cre}",
  "umol/g": "umol/g",
  "umol/g{Cre}": "umol/g{Cre}",
  "umol/g Cre": "umol/g{Cre}",
  "umol/g{Hgb}": "umol/g{Hgb}",
  "umol/g Hgb": "umol/g{Hgb}",
  "mmol/g": "mmol/g",
  "osm/kg": "osm/kg",
  "Osm/kg": "osm/kg",
  "meq/g": "meq/g",
  "meq/g{Cre}": "meq/g{Cre}",
  "meq/g Cre": "meq/g{Cre}",
  "meq/kg": "meq/kg",
  "[iU]/g": "[iU]/g",
  "IU/g": "[iU]/g",
  "[iU]/g{Hgb}": "[iU]/g{Hgb}",
  "IU/g Hgb": "[iU]/g{Hgb}",
  "{Ehrlich_U}/100g": "{Ehrlich_U}/100g",
  "EU/100 g": "{Ehrlich_U}/100g",
  "[iU]/kg": "[iU]/kg",
  "IU/kg": "[iU]/kg",
  "umol/min/g": "umol/min/g",
  "mU/g": "mU/g",
  "mU/g{Hgb}": "mU/g{Hgb}",
  "mU/g Hgb": "mU/g{Hgb}",
  "U/g": "U/g",
  "U/g{Hgb}": "U/g{Hgb}",
  "U/g Hgb": "U/g{Hgb}",
  "U/g{Cre}": "U/g{Cre}",
  "U/g Cre": "U/g{Cre}",
  "mU/mg{Cre}": "mU/mg{Cre}",
  "mU/mg Cre": "mU/mg{Cre}",
  "mU/mg": "mU/mg",
  "kU/g": "kU/g",
  "kat/kg": "kat/kg",
  "mL/kg": "mL/kg",
  "L/kg": "L/kg",
  "kCal/[oz_av]": "kCal/[oz_av]",
  "kCal/oz": "kCal/[oz_av]",
  "/m2": "/m2",
  "/m^2": "/m2",
  "g/m2": "g/m2",
  "g/m^2": "g/m2",
  "kg/m2": "kg/m2",
  "kg/m^2": "kg/m2",
  "ug/m2": "ug/m2",
  "ug/m^2": "ug/m2",
  "mg/m2": "mg/m2",
  "mg/m^2": "mg/m2",
  "ng/m2": "ng/m2",
  "ng/m^2": "ng/m2",
  "g.m": "g.m",
  "Gram Meter": "g.m",
  "g.m/{hb}": "g.m/{hb}",
  "Gram Meter/Heartbeat": "g.m/{hb}",
  "g.m/({hb}.m2)": "g.m/({hb}.m2)",
  "Gram Meter/Heartbeat/m^2": "g.m/({hb}.m2)",
  "kg/mol": "kg/mol",
  "{Cells}/uL": "{Cells}/uL",
  "cells/uL": "{Cells}/uL",
  "{rbc}/uL": "{rbc}/uL",
  "RBC/mm^3": "{rbc}/uL",
  "10*9/uL": "10*9/uL",
  "10^9/uL": "10*9/uL",
  "/mL": "/mL",
  "{Spermatozoa}/mL": "{Spermatozoa}/mL",
  "Sperm/mL": "{Spermatozoa}/mL",
  "{Copies}/mL": "{Copies}/mL",
  "Copies/mL": "{Copies}/mL",
  "10*3/mL": "10*3/mL",
  "10^3/mL": "10*3/mL",
  "10*3{Copies}/mL": "10*3{Copies}/mL",
  "10^3 copies/mL": "10*3{Copies}/mL",
  "10*6/mL": "10*6/mL",
  "10^6/mL": "10*6/mL",
  "10*9/mL": "10*9/mL",
  "10^9/mL": "10*9/mL",
  "{cfu}/mL": "{cfu}/mL",
  "cfu/mL": "{cfu}/mL",
  "/dL": "/dL",
  "/L": "/L",
  "10*3/L": "10*3/L",
  "10^3/L": "10*3/L",
  "10*6/L": "10*6/L",
  "10^6/L": "10*6/L",
  "10*12/L": "10*12/L",
  "10^12/L": "10*12/L",
  "10*9/L": "10*9/L",
  "10^9/L": "10*9/L",
  "ng/mL{rbc}": "ng/mL{rbc}",
  "ng/mL RBCs": "ng/mL{rbc}",
  "mg/mL": "mg/mL",
  "pg/dL": "pg/dL",
  "ng/dL": "ng/dL",
  "ug/dL{rbc}": "ug/dL{rbc}",
  "ug/dL RBCs": "ug/dL{rbc}",
  "mg{Phenylketones}/dL": "mg{Phenylketones}/dL",
  "mg Phe/dL": "mg{Phenylketones}/dL",
  "ng/L": "ng/L",
  "pg/L": "pg/L",
  "mg/L": "mg/L",
  "kg/L": "kg/L",
  "mg/m3": "mg/m3",
  "mg/m^3": "mg/m3",
  "kg/m3": "kg/m3",
  "kg/m^3": "kg/m3",
  "fmol/mL": "fmol/mL",
  "pmol/mL": "pmol/mL",
  "nmol/mL": "nmol/mL",
  "umol/mL": "umol/mL",
  "mol/mL": "mol/mL",
  "pmol/dL": "pmol/dL",
  "nmol/dL": "nmol/dL",
  "umol/dL": "umol/dL",
  "mmol/dL": "mmol/dL",
  "mol/L": "mol/L",
  "mol/m3": "mol/m3",
  "mol/m^3": "mol/m3",
  "ueq/mL": "ueq/mL",
  "meq/mL": "meq/mL",
  "eq/mL": "eq/mL",
  "{AHG}eq/mL": "{AHG}eq/mL",
  "AHG eq/mL": "{AHG}eq/mL",
  "10*6.eq/mL": "10*6.eq/mL",
  "10^6 eq/mL": "10*6.eq/mL",
  "ueq/L": "ueq/L",
  "ueg/L": "ueq/L",
  "eq/L": "eq/L",
  "eg/L": "eq/L",
  "meq/dL": "meq/dL",
  "meg/dL": "meq/dL",
  "mosm/L": "mosm/L",
  "mOsm/L": "mosm/L",
  "osm/L": "osm/L",
  "Osm/L": "osm/L",
  "{IgGPhospholipid}U/mL": "{IgGPhospholipid}U/mL",
  "IgG Phospholipid U/mL": "{IgGPhospholipid}U/mL",
  "{IgMPhospholipid}U/mL": "{IgMPhospholipid}U/mL",
  "IgM Phospholipid U/mL": "{IgMPhospholipid}U/mL",
  "{ComplementCh50}U/mL": "{ComplementCh50}U/mL",
  "CH50 U/mL": "{ComplementCh50}U/mL",
  "{IgAPhospholipid}U/mL": "{IgAPhospholipid}U/mL",
  "IgA Phospholipid U/mL": "{IgAPhospholipid}U/mL",
  "{Elisa_U}/mL": "{Elisa_U}/mL",
  "Elisa U/mL": "{Elisa_U}/mL",
  "[iU]/mL": "[iU]/mL",
  "IU/mL": "[iU]/mL",
  "k[iU]/mL": "k[iU]/mL",
  "kIU/mL": "k[iU]/mL",
  "[iU]/dL": "[iU]/dL",
  "IU/dL": "[iU]/dL",
  "{Ehrlich_U}/dL": "{Ehrlich_U}/dL",
  "EU/dL": "{Ehrlich_U}/dL",
  "m[iU]/L": "m[iU]/L",
  "mIU/L": "m[iU]/L",
  "[pH]": "[pH]",
  pH: "[pH]",
};
