import { z } from "zod";
import { fromQuestEnum, fromQuestInteger, fromQuestString, IncomingFileRowSchema } from "./shared";
import { IncomingFile, fromQuestDate } from "./shared";

export type ResponseFile = IncomingFile<ResponseHeader, ResponseDetail, ResponseFooter>;

export const responseHeaderSchema = z.object({
  recordType: z.enum(["H"]),
});

export type ResponseHeader = z.infer<typeof responseHeaderSchema>;

export const responseHeaderRow: IncomingFileRowSchema<ResponseHeader> = [
  {
    field: 1,
    length: 1,
    key: "recordType",
    fromQuest: fromQuestEnum(["H"]),
  },
];

export const responseDetailSchema = z.object({
  dateOfService: z.date(),
  accessionNumber: z.string(),
  requisitionNumber: z.string().optional(),
  labCode: z.string(),
  dateCollected: z.date().optional(),
  patientId: z.string(),
  patientFirstName: z.string().optional(),
  patientMiddleName: z.string().optional(),
  patientLastName: z.string().optional(),
  addressLine1: z.string().optional(),
  addressLine2: z.string().optional(),
  city: z.string().optional(),
  state: z.string().optional(),
  zipCode: z.string().optional(),
  phoneNumber: z.string().optional(),
  dateOfBirth: z.string().optional(),
  patientAge: z.string().optional(),
  gender: z.string().optional(),
  socialSecurityNumber: z.string().optional(),
  questBillingIdentifier: z.string().optional(),
  memberNumber: z.string().optional(),
  medicaidId: z.string().optional(),
  medicareId: z.string().optional(),
  orderingAccountNumber: z.string().optional(),
  orderingAccountName: z.string().optional(),
  orderingAccountAddressLine1: z.string().optional(),
  orderingAccountAddressLine2: z.string().optional(),
  orderingAccountCity: z.string().optional(),
  orderingAccountState: z.string().optional(),
  orderingAccountZipCode: z.string().optional(),
  orderingAccountPhoneNumber: z.string().optional(),
  physicianName: z.string().optional(),
  physicianUpin: z.string().optional(),
  physicianNpi: z.string().optional(),
  diagnosisCode1: z.string().optional(),
  diagnosisCode2: z.string().optional(),
  diagnosisCode3: z.string().optional(),
  diagnosisCode4: z.string().optional(),
  diagnosisCode5: z.string().optional(),
  diagnosisCode6: z.string().optional(),
  diagnosisCode7: z.string().optional(),
  diagnosisCode8: z.string().optional(),
  diagnosisCode9: z.string().optional(),
  diagnosisCode10: z.string().optional(),
  localProfileCode: z.string().optional(),
  standardProfileCode: z.string().optional(),
  profileName: z.string().optional(),
  localOrderCode: z.string(),
  standardOrderCode: z.string().optional(),
  orderName: z.string().optional(),
  loincCode: z.string().optional(),
  localResultCode: z.string(),
  resultName: z.string().optional(),
  resultValue: z.string().optional(),
  resultUnits: z.string().optional(),
  referenceRangeLow: z.string().optional(),
  referenceRangeHigh: z.string().optional(),
  referenceRangeAlpha: z.string().optional(),
  abnormalFlag: z.string().optional(),
  cptCode: z.string().optional(),
  resultComments: z.string().optional(),
});

export type ResponseDetail = z.infer<typeof responseDetailSchema>;

export const responseDetailRow: IncomingFileRowSchema<ResponseDetail> = [
  {
    field: 1,
    length: 8,
    key: "dateOfService",
    fromQuest: fromQuestDate(),
  },
  {
    field: 2,
    length: 16,
    key: "accessionNumber",
    fromQuest: fromQuestString(),
  },
  {
    field: 3,
    length: 16,
    key: "requisitionNumber",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 4,
    length: 4,
    key: "labCode",
    fromQuest: fromQuestString(),
  },
  {
    field: 5,
    length: 8,
    key: "dateCollected",
    fromQuest: fromQuestDate({ optional: true }),
  },
  {
    field: 6,
    length: 30,
    key: "patientId",
    fromQuest: fromQuestString(),
  },
  {
    field: 7,
    length: 20,
    key: "patientFirstName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 8,
    length: 20,
    key: "patientMiddleName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 9,
    length: 25,
    key: "patientLastName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 10,
    length: 30,
    key: "addressLine1",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 11,
    length: 30,
    key: "addressLine2",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 12,
    length: 25,
    key: "city",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 13,
    length: 2,
    key: "state",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 14,
    length: 10,
    key: "zipCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 15,
    length: 20,
    key: "phoneNumber",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 16,
    length: 8,
    key: "dateOfBirth",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 17,
    length: 3,
    key: "patientAge",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 18,
    length: 1,
    key: "gender",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 19,
    length: 10,
    key: "socialSecurityNumber",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 20,
    length: 10,
    key: "questBillingIdentifier",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 21,
    length: 25,
    key: "memberNumber",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 22,
    length: 15,
    key: "medicaidId",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 23,
    length: 15,
    key: "medicareId",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 24,
    length: 18,
    key: "orderingAccountNumber",
    fromQuest: fromQuestString(),
  },
  {
    field: 25,
    length: 60,
    key: "orderingAccountName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 26,
    length: 40,
    key: "orderingAccountAddressLine1",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 27,
    length: 40,
    key: "orderingAccountAddressLine2",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 28,
    length: 25,
    key: "orderingAccountCity",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 29,
    length: 2,
    key: "orderingAccountState",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 30,
    length: 10,
    key: "orderingAccountZipCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 31,
    length: 20,
    key: "orderingAccountPhoneNumber",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 32,
    length: 30,
    key: "physicianName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 33,
    length: 6,
    key: "physicianUpin",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 34,
    length: 10,
    key: "physicianNpi",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 35,
    length: 12,
    key: "diagnosisCode1",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 36,
    length: 12,
    key: "diagnosisCode2",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 37,
    length: 12,
    key: "diagnosisCode3",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 38,
    length: 12,
    key: "diagnosisCode4",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 39,
    length: 12,
    key: "diagnosisCode5",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 40,
    length: 12,
    key: "diagnosisCode6",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 41,
    length: 12,
    key: "diagnosisCode7",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 42,
    length: 12,
    key: "diagnosisCode8",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 43,
    length: 12,
    key: "diagnosisCode9",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 44,
    length: 12,
    key: "diagnosisCode10",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 45,
    length: 18,
    key: "localProfileCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 46,
    length: 18,
    key: "standardProfileCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 47,
    length: 60,
    key: "profileName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 48,
    length: 18,
    key: "localOrderCode",
    fromQuest: fromQuestString(),
  },
  {
    field: 49,
    length: 18,
    key: "standardOrderCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 50,
    length: 60,
    key: "orderName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 51,
    length: 10,
    key: "loincCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 52,
    length: 18,
    key: "localResultCode",
    fromQuest: fromQuestString(),
  },
  {
    field: 53,
    length: 60,
    key: "resultName",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 54,
    length: 225,
    key: "resultValue",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 55,
    length: 20,
    key: "resultUnits",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 56,
    length: 13,
    key: "referenceRangeLow",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 57,
    length: 13,
    key: "referenceRangeHigh",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 58,
    length: 20,
    key: "referenceRangeAlpha",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 59,
    length: 2,
    key: "abnormalFlag",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 60,
    length: 5,
    key: "cptCode",
    fromQuest: fromQuestString({ optional: true }),
  },
  {
    field: 61,
    length: 500,
    key: "resultComments",
    fromQuest: fromQuestString({ optional: true }),
  },
];

export const responseFooterSchema = z.object({
  recordType: z.enum(["T"]),
  totalRecords: z.number(),
});

export type ResponseFooter = z.infer<typeof responseFooterSchema>;

export const responseFooterRow: IncomingFileRowSchema<ResponseFooter> = [
  {
    field: 1,
    length: 1,
    key: "recordType",
    fromQuest: fromQuestEnum(["T"]),
  },
  {
    field: 2,
    length: 10,
    key: "totalRecords",
    fromQuest: fromQuestInteger(),
  },
];
