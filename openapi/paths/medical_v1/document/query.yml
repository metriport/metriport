post:
  description: >-
    Triggers a document query for the specified patient across HIEs.

    When executed, this endpoint triggers an asynchronous document query across
    HIEs.

    This is a two step process where the documents will first be downloaded from

    the respective HIE and, if they are C-CDA/XML, then converted to FHIR.

    Each process (download, conversion) will contain its own `total` and
    `status`

    as well as the count for `successful` operations and `errors`.

    When the asynchronous document query finishes, it stores new/updated
    document

    references for future requests and updates the status of download to
    `completed`.

    Meanwhile, in the background, files will be converted and the convert count
    will be

    incremented. Once all documents have been converted it too will be marked as
    `completed`.

    If there's no document to be converted, the total will be set to zero and

    the status to `completed`.
  operationId: medical_document_startQuery
  tags:
    - MedicalDocument
  parameters:
    - name: patientId
      in: query
      description: The ID of the Patient for which to list available Documents.
      required: true
      schema:
        type: string
      examples:
        Example1:
          value: 018a80c4-292a-7486-a1234-76yuhe23yu14
    - name: facilityId
      in: query
      description: The ID of the Facility where the patient is receiving care.
      required: true
      schema:
        type: string
      examples:
        Example1:
          value: 018a80c4-292a-7486-a1234-9uiu76yhe234
  responses:
    '200':
      description: ''
      content:
        application/json:
          schema:
            $ref: ../../../components/schemas/medical/medicalDocumentQuery.yml
          examples:
            Example1:
              value:
                download:
                  status: completed
                  total: 100
                  successful: 98
                  errors: 2
                convert:
                  status: processing
  summary: Start Document Query
  security:
    - ApiKeyAuth: []
  requestBody:
    description: >
      Metadata holds a record of up to 50 custom string key-value pairs. Key
      names can be up to 40 characters long and values up to 500 characters
      long. 

      This metadata will be returned in the webhook response.
    required: false
    content:
      application/json:
        schema:
          type: object
          additionalProperties:
            type: string
          nullable: true
        examples:
          Example1:
            value:
              youCan: putAny
              stringKeyValue: pairsHere
get:
  description: >-
    Returns the document query status for the specified patient.

    Can be used in to check the progress when the final status

    of the document query is taking longer than expected.

    See more on [Start Document
    Query](/medical-api/api-reference/document/start-document-query).
  operationId: medical_document_getQueryStatus
  tags:
    - MedicalDocument
  parameters:
    - name: patientId
      in: query
      description: The ID of the Patient for which to list available Documents.
      required: true
      schema:
        type: string
      examples:
        Example1:
          value: 018a80c4-292a-7486-a1234-76yuhe23yu14
  responses:
    '200':
      description: ''
      content:
        application/json:
          schema:
            $ref: ../../../components/schemas/medical/medicalDocumentQuery.yml
          examples:
            Example1:
              value:
                download:
                  status: completed
                  total: 100
                  successful: 98
                  errors: 2
                convert:
                  status: processing
  summary: Get Document Query Status
  security:
    - ApiKeyAuth: []
