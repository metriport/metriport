#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

changed() {
  git diff --name-only HEAD@{1} HEAD | grep "$1" > /dev/null 2>&1
}

echo "Checking updates on package.json files..."

if changed 'package.json' || changed 'api/app/package.json' || changed 'connect-widget/app/package.json' || changed 'infra/package.json'; then
  echo " "
  echo "⚠  One or more package.json changed. You should run 'npm install' on the root folder"
  echo " "
else
  echo "No updates detected on package.json files."
fi

echo "Checking updates on DB migration files..."

if changed 'api/app/src/sequelize/migrations'; then
  echo " "
  echo "⚠  DB updates detected. You should run 'npm run db-local:up' on ./api/app"
  echo " "
else
  echo "No DB updates detected."
fi
